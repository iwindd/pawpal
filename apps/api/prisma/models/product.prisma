model Package {
  id          String   @id @default(cuid())
  name        String
  price       Decimal  @db.Decimal(10, 2)
  description String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  order       Int      @default(0)

  product   Product @relation("ProductPackages", fields: [productId], references: [id])
  productId String  @map("product_id")

  sales         Sale[]         @relation("PackageSales")
  orderPackages OrderPackage[] @relation("OrderPackages")

  @@index([productId])
  @@index([price])
  @@map("packages")
}

model Product {
  id          String   @id @default(cuid())
  slug        String   @unique
  name        String
  description String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  category   Category @relation("ProductCategory", fields: [categoryId], references: [id])
  categoryId String   @map("category_id")

  productTags ProductTag[]   @relation("ProductTags")
  packages    Package[]      @relation("ProductPackages")
  carousels   Carousel[]     @relation("ProductCarousels")
  fields      ProductField[] @relation("ProductFields")
  image       Resource?      @relation("ProductImage", fields: [imageId], references: [id])
  imageId     String?        @map("image_id")

  @@index([slug])
  @@index([categoryId])
  @@index([createdAt])
  @@map("products")
}

model Category {
  id        String   @id @default(cuid())
  slug      String   @unique
  name      String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  products Product[] @relation("ProductCategory")

  @@index([slug])
  @@index([name])
  @@map("categories")
}

model ProductTag {
  id        String   @id @default(cuid())
  slug      String   @unique
  name      String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  type      TagType  @default(USER_DEFINED)

  products Product[] @relation("ProductTags")

  @@index([slug])
  @@index([type])
  @@map("product_tags")
}

enum TagType {
  USER_DEFINED
  SYSTEM
}

model ProductField {
  id          String    @id @default(cuid())
  label       String
  placeholder String?
  metadata    Json      @default("{}")
  type        FieldType @default(TEXT)

  creator   User?   @relation("FieldCreatedBy", fields: [creatorId], references: [id])
  creatorId String? @map("creator_id")

  optional Boolean @default(false)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  order Int @default(0)

  productId String  @map("product_id")
  product   Product @relation("ProductFields", fields: [productId], references: [id])

  orderFields OrderField[] @relation("OrderFields")

  @@map("product_fields")
}

enum FieldType {
  TEXT
  EMAIL
  SELECT
  PASSWORD
}
